<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>ros_robotic_skin: CartesianController.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_53e6fa9553ac22a5646d2a2b2d7b97a1.html">scripts</a></li><li class="navelem"><a class="el" href="dir_58ac4badafb61b77d72213a8c9d62706.html">controllers</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CartesianController.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="CartesianController_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html">    1</a></span>&#160;<span class="comment">#!/usr/bin/env python</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">from</span> PandaController <span class="keyword">import</span> PandaController</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">import</span> rospy</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">import</span> moveit_commander</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">import</span> tf</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html">   10</a></span>&#160;<span class="keyword">class </span><a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html">CartesianController</a>(object):</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral">    Cartesian controller built on top of PandaController. clean code</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="comment"># TODO: Fix: When trajectory points are to close to each other, the movement is intermittent, because self.stop() is called too much.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="comment"># TODO: Avoid self collision</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a01a4da5084d7fc63616c6398656a4d8a">   18</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a01a4da5084d7fc63616c6398656a4d8a">__init__</a>(self):</div><div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a452d57bd9bfb08c7b3769b362c3988b0">   19</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a452d57bd9bfb08c7b3769b362c3988b0">panda_controller</a> = <a class="code" href="classscripts_1_1controllers_1_1PandaController_1_1PandaController.html">PandaController</a>()</div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#adad5bd5066c2cf4ba9a39cca77355638">   20</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#adad5bd5066c2cf4ba9a39cca77355638">move_group_commander</a> = moveit_commander.move_group.MoveGroupCommander(<span class="stringliteral">&#39;panda_arm&#39;</span>)</div><div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a7a9b1e165d9a1b9b37f482fa5f3940d8">   21</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a7a9b1e165d9a1b9b37f482fa5f3940d8">tf_listener</a> = tf.TransformListener()</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aa64d859a6419acc7a4c6beb60fa9bc1f">   22</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aa64d859a6419acc7a4c6beb60fa9bc1f">rate</a> = rospy.Rate(rospy.get_param(<span class="stringliteral">&#39;/cartesian_controller_frequency&#39;</span>))</div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aeed38ae85c8f4fe87f153e6ea4d27c33">   23</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aeed38ae85c8f4fe87f153e6ea4d27c33">q_dot</a> = np.zeros(7)</div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a33a503de3185004215aa687b35c5f5ee">   24</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a33a503de3185004215aa687b35c5f5ee">p_gain</a> = rospy.get_param(<span class="stringliteral">&#39;/cartesian_controller_p_gain&#39;</span>)</div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#af7a86df63d70acb6b36d0e6845b40838">   25</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#af7a86df63d70acb6b36d0e6845b40838">error_threshold</a> = rospy.get_param(<span class="stringliteral">&#39;/cartesian_error_threshold&#39;</span>)</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        rospy.on_shutdown(self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aad679fdf9f01efed948edbf7e7a893ac">stop</a>)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#ae9972f94ea63f6e2e70d954c8413fbc9">   28</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#ae9972f94ea63f6e2e70d954c8413fbc9">position</a> = self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a85065b1b96efcc4d6a09f26f56e6f4dc">__get_current_end_effector_position</a>()</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a85065b1b96efcc4d6a09f26f56e6f4dc">   30</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a85065b1b96efcc4d6a09f26f56e6f4dc">__get_current_end_effector_position</a>(self):</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">        Get the current end effector position in cartesian coordinates</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">        Returns</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral">        -------</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="stringliteral">        trans : numpy.ndarray</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="stringliteral">            3x1 vector containing current end effector position vector</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <span class="keywordflow">while</span> <span class="keyword">True</span>:</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                (trans, rot) = self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a7a9b1e165d9a1b9b37f482fa5f3940d8">tf_listener</a>.lookupTransform(<span class="stringliteral">&#39;world&#39;</span>, <span class="stringliteral">&#39;panda_hand&#39;</span>, rospy.Time(0))</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                <span class="keywordflow">return</span> np.array(trans)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            <span class="keywordflow">except</span> (tf.LookupException,</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                    tf.ConnectivityException,</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                    tf.ExtrapolationException):</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                <span class="keywordflow">continue</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a90cbafea24b7ecf8591592263b7a448b">   48</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a90cbafea24b7ecf8591592263b7a448b">__compute_command_velocity</a>(self, position_desired):</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="stringliteral">        Compute the velocity vector in cartesian coordinates that leads to the Point position_desired at a given time instant.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="stringliteral">        Parameters</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="stringliteral">        ----------</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="stringliteral">        position_desired : numpy.ndarray</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="stringliteral">            3x1 end effector desired position vector</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="stringliteral">        Returns</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="stringliteral">        -------</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="stringliteral">        v: numpy.ndarray</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="stringliteral">            6x1 velocity vector in cartesian coordinates</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a093542bb0f597406be64a5de8b26ac23">   63</a></span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a093542bb0f597406be64a5de8b26ac23">error</a> = position_desired - self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#ae9972f94ea63f6e2e70d954c8413fbc9">position</a></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        v_trans = self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a33a503de3185004215aa687b35c5f5ee">p_gain</a> * self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a093542bb0f597406be64a5de8b26ac23">error</a> / np.linalg.norm(self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a093542bb0f597406be64a5de8b26ac23">error</a>)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        v_rot = np.array([0, 0, 0])</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        v = np.block([v_trans, v_rot])</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        v.shape = (6, 1)</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">return</span> v</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a413edd9124ea4056f821d1091d445947">   71</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a413edd9124ea4056f821d1091d445947">__compute_command_q_dot</a>(self, v):</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="stringliteral">        Convert cartesian velocity vector to joint space through Jacobian</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral">        Parameters</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral">        ----------</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral">        v : numpy.ndarray</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">             6x1 velocity vector in cartesian coordinates</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">        Returns</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral">        -------</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="stringliteral">        q_dot : numpy.ndarray</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="stringliteral">            7x1 joint velocity vector</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        q = self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#adad5bd5066c2cf4ba9a39cca77355638">move_group_commander</a>.get_current_joint_values()</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        J = self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#adad5bd5066c2cf4ba9a39cca77355638">move_group_commander</a>.get_jacobian_matrix(q)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        q_dot = np.linalg.pinv(J) * v</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">return</span> q_dot</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a30e6c2805ccbebe23faf5dd89f573ebb">   90</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a30e6c2805ccbebe23faf5dd89f573ebb">go_to_point</a>(self, position_desired):</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="stringliteral">        Move to a point an stop when arrived</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="stringliteral">        Parameters</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="stringliteral">        ----------</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="stringliteral">        position_desired : numpy.ndarray</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="stringliteral">            3x1 end effector desired position vector</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="stringliteral">            Only position, not orientation</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        position_desired = np.array(position_desired)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a093542bb0f597406be64a5de8b26ac23">error</a> = position_desired - self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#ae9972f94ea63f6e2e70d954c8413fbc9">position</a></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">while</span> np.linalg.norm(self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a093542bb0f597406be64a5de8b26ac23">error</a>) &gt; self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#af7a86df63d70acb6b36d0e6845b40838">error_threshold</a>:</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#ae9972f94ea63f6e2e70d954c8413fbc9">position</a> = self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a85065b1b96efcc4d6a09f26f56e6f4dc">__get_current_end_effector_position</a>()</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            velocity = self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a90cbafea24b7ecf8591592263b7a448b">__compute_command_velocity</a>(position_desired)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aeed38ae85c8f4fe87f153e6ea4d27c33">q_dot</a> = self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a413edd9124ea4056f821d1091d445947">__compute_command_q_dot</a>(velocity)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a452d57bd9bfb08c7b3769b362c3988b0">panda_controller</a>.send_velocities(self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aeed38ae85c8f4fe87f153e6ea4d27c33">q_dot</a>)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aa64d859a6419acc7a4c6beb60fa9bc1f">rate</a>.<a class="code" href="namespacescripts_1_1imu__spawners_1_1spawn__imu.html#a7868695cd7c69305a950892e1f24f3b1">sleep</a>()</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aad679fdf9f01efed948edbf7e7a893ac">stop</a>()</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">return</span> 0</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#acf0aa1426387e33747037c4acccbc7f4">  111</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#acf0aa1426387e33747037c4acccbc7f4">go_to_points_in_trajectory</a>(self, trajectory):</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="stringliteral">        Move through a series of points and stop when arrived.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="stringliteral">        Parameters</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="stringliteral">        ----------</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="stringliteral">        trajectory : list</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="stringliteral">            List containing as many 3x1 np.ndarray position vectors as desired.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="stringliteral">            Position vectors do not specify rotation</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">for</span> point <span class="keywordflow">in</span> trajectory:</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a30e6c2805ccbebe23faf5dd89f573ebb">go_to_point</a>(point)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aa64d859a6419acc7a4c6beb60fa9bc1f">rate</a>.<a class="code" href="namespacescripts_1_1imu__spawners_1_1spawn__imu.html#a7868695cd7c69305a950892e1f24f3b1">sleep</a>()</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aad679fdf9f01efed948edbf7e7a893ac">stop</a>()</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">return</span> 0</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aad679fdf9f01efed948edbf7e7a893ac">  127</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aad679fdf9f01efed948edbf7e7a893ac">stop</a>(self):</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral">        Stop all joints</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        q_dot = np.zeros(7)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        self.<a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a452d57bd9bfb08c7b3769b362c3988b0">panda_controller</a>.send_velocities(q_dot)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">return</span> 0</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment"># Get trajectory points in a circle at plane x = X, centered at (x0, y0, z0), with radius r</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#a3fa8e604c06a35cf7dfd24cba986076e">  140</a></span>&#160;    trajectory = []</div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#a2de32ba6cd3d13fa2eae6620f7886aec">  141</a></span>&#160;    x0 = 0.3</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#a7d879d1b9201aeb2fb58de01b1becde4">  142</a></span>&#160;    y0 = 0.0</div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#af45701ec879c47be4503d800444df245">  143</a></span>&#160;    z0 = 0.3</div><div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#acca3a1db1403fff523bedec47f5afa6f">  144</a></span>&#160;    r = 0.1</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">for</span> theta <span class="keywordflow">in</span> np.arange(0, 2*np.pi, 0.2):</div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#ab0d182c94afa2a08180344877122a52c">  146</a></span>&#160;        x = x0</div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#a7a559c9d89068514c16c21afafd6b924">  147</a></span>&#160;        y = y0 + r * np.cos(theta)</div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#aff6dde0b42b76ed011c8f734de7609fe">  148</a></span>&#160;        z = z0 + r * np.sin(theta)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        trajectory.append([x, y, z])</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment"># Loop that trajectory</span></div><div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="namespacescripts_1_1controllers_1_1CartesianController.html#a545a68609ae71da8d09269083fe3d487">  152</a></span>&#160;    cartesian_controller = <a class="code" href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html">CartesianController</a>()</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">while</span> <span class="keywordflow">not</span> rospy.is_shutdown():</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        cartesian_controller.go_to_points_in_trajectory(trajectory)</div><div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_acf0aa1426387e33747037c4acccbc7f4"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#acf0aa1426387e33747037c4acccbc7f4">scripts.controllers.CartesianController.CartesianController.go_to_points_in_trajectory</a></div><div class="ttdeci">def go_to_points_in_trajectory(self, trajectory)</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00111">CartesianController.py:111</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a452d57bd9bfb08c7b3769b362c3988b0"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a452d57bd9bfb08c7b3769b362c3988b0">scripts.controllers.CartesianController.CartesianController.panda_controller</a></div><div class="ttdeci">panda_controller</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00019">CartesianController.py:19</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a093542bb0f597406be64a5de8b26ac23"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a093542bb0f597406be64a5de8b26ac23">scripts.controllers.CartesianController.CartesianController.error</a></div><div class="ttdeci">error</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00063">CartesianController.py:63</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a01a4da5084d7fc63616c6398656a4d8a"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a01a4da5084d7fc63616c6398656a4d8a">scripts.controllers.CartesianController.CartesianController.__init__</a></div><div class="ttdeci">def __init__(self)</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00018">CartesianController.py:18</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_aeed38ae85c8f4fe87f153e6ea4d27c33"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aeed38ae85c8f4fe87f153e6ea4d27c33">scripts.controllers.CartesianController.CartesianController.q_dot</a></div><div class="ttdeci">q_dot</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00023">CartesianController.py:23</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a85065b1b96efcc4d6a09f26f56e6f4dc"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a85065b1b96efcc4d6a09f26f56e6f4dc">scripts.controllers.CartesianController.CartesianController.__get_current_end_effector_position</a></div><div class="ttdeci">def __get_current_end_effector_position(self)</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00030">CartesianController.py:30</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_aad679fdf9f01efed948edbf7e7a893ac"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aad679fdf9f01efed948edbf7e7a893ac">scripts.controllers.CartesianController.CartesianController.stop</a></div><div class="ttdeci">def stop(self)</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00127">CartesianController.py:127</a></div></div>
<div class="ttc" id="namespacescripts_1_1imu__spawners_1_1spawn__imu_html_a7868695cd7c69305a950892e1f24f3b1"><div class="ttname"><a href="namespacescripts_1_1imu__spawners_1_1spawn__imu.html#a7868695cd7c69305a950892e1f24f3b1">scripts.imu_spawners.spawn_imu.sleep</a></div><div class="ttdeci">sleep</div><div class="ttdef"><b>Definition:</b> <a href="spawn__imu_8py_source.html#l00227">spawn_imu.py:227</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a33a503de3185004215aa687b35c5f5ee"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a33a503de3185004215aa687b35c5f5ee">scripts.controllers.CartesianController.CartesianController.p_gain</a></div><div class="ttdeci">p_gain</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00024">CartesianController.py:24</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a7a9b1e165d9a1b9b37f482fa5f3940d8"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a7a9b1e165d9a1b9b37f482fa5f3940d8">scripts.controllers.CartesianController.CartesianController.tf_listener</a></div><div class="ttdeci">tf_listener</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00021">CartesianController.py:21</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1PandaController_1_1PandaController_html"><div class="ttname"><a href="classscripts_1_1controllers_1_1PandaController_1_1PandaController.html">scripts.controllers.PandaController.PandaController</a></div><div class="ttdef"><b>Definition:</b> <a href="PandaController_8py_source.html#l00032">PandaController.py:32</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a90cbafea24b7ecf8591592263b7a448b"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a90cbafea24b7ecf8591592263b7a448b">scripts.controllers.CartesianController.CartesianController.__compute_command_velocity</a></div><div class="ttdeci">def __compute_command_velocity(self, position_desired)</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00048">CartesianController.py:48</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_af7a86df63d70acb6b36d0e6845b40838"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#af7a86df63d70acb6b36d0e6845b40838">scripts.controllers.CartesianController.CartesianController.error_threshold</a></div><div class="ttdeci">error_threshold</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00025">CartesianController.py:25</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html">scripts.controllers.CartesianController.CartesianController</a></div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00010">CartesianController.py:10</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_aa64d859a6419acc7a4c6beb60fa9bc1f"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#aa64d859a6419acc7a4c6beb60fa9bc1f">scripts.controllers.CartesianController.CartesianController.rate</a></div><div class="ttdeci">rate</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00022">CartesianController.py:22</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_ae9972f94ea63f6e2e70d954c8413fbc9"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#ae9972f94ea63f6e2e70d954c8413fbc9">scripts.controllers.CartesianController.CartesianController.position</a></div><div class="ttdeci">position</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00028">CartesianController.py:28</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_adad5bd5066c2cf4ba9a39cca77355638"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#adad5bd5066c2cf4ba9a39cca77355638">scripts.controllers.CartesianController.CartesianController.move_group_commander</a></div><div class="ttdeci">move_group_commander</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00020">CartesianController.py:20</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a413edd9124ea4056f821d1091d445947"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a413edd9124ea4056f821d1091d445947">scripts.controllers.CartesianController.CartesianController.__compute_command_q_dot</a></div><div class="ttdeci">def __compute_command_q_dot(self, v)</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00071">CartesianController.py:71</a></div></div>
<div class="ttc" id="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController_html_a30e6c2805ccbebe23faf5dd89f573ebb"><div class="ttname"><a href="classscripts_1_1controllers_1_1CartesianController_1_1CartesianController.html#a30e6c2805ccbebe23faf5dd89f573ebb">scripts.controllers.CartesianController.CartesianController.go_to_point</a></div><div class="ttdeci">def go_to_point(self, position_desired)</div><div class="ttdef"><b>Definition:</b> <a href="CartesianController_8py_source.html#l00090">CartesianController.py:90</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/ros_robotic_skin">ros_robotic_skin</a><br />
Author(s): </br />
<small>autogenerated on Fri May 8 2020 04:34:25</small>
</div>
</body>
</html>
